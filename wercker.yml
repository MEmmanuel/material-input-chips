box: node

build:
  steps:
    - script:
      name: install yarn
      code: npm install -g yarn

    - script:
      name: set yarn cache
      code: export YARN_CACHE=$WERCKER_CACHE_DIR/yarn

    - script:
      name: install dependencies
      code: HOME=$YARN_CACHE yarn

    - npm-test

    - script:
      name: build dist
      code: npm run build

deploy:
  steps:
      - script:
        name: get version of package.json
        code: |
          export APP_VERSION=$(node deploy.js)
          echo "APP_VERSION= $APP_VERSION"

      - github-create-release:
        token: $GITHUB_TOKEN
        tag: $APP_VERSION

      - mariosant/npm-publish@2.0.2:
        token: $NPM_TOKEN

# ghpages:
#   steps:
#     - script:
#       name: Gene

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    # - script:
    #     name: verify tag package.json
    #     code: |
    #       echo 'ls'
    #       ls
    #       echo 'git status'
    #       git status
    #       val=$(node deploy.js)
    #       echo "node returned: $val"